<div class="order_details_section py-5">
  <div class="container">
    <div class="order_details_wrapper">
      <!-- Header -->
      <div class="order_details_content text-center mb-5">
        <h2 class="fw-bold">Order Details</h2>
        <p class="mb-3 text-muted">Thank you for your order! Here are the details of your purchase:</p>
        <a href="{{ routes.account_url }}" class="btn btn-dark">Return To Dashboard</a>
      </div>

      <div class="row g-4">
        <!-- Left Column -->
        <div class="col-lg-8">
          <div class="order_history card shadow-sm border-0">
            <div class="card-body">
              <div class="order_header mb-4">
                <h4 class="fw-bold">Order: {{ order.name }}</h4>
                <p class="mb-1 text-muted">Placed on {{ order.created_at | time_tag : format: 'date' }}</p>
                {% if order.cancelled %}
                  <span class="badge bg-danger">Cancelled</span>
                  <p class="mb-0 small text-muted">Reason: {{ order.cancel_reason_label }}</p>
                {% endif %}
              </div>

              <!-- Order Table -->
              <div class="table-responsive">
                <table class="table align-middle">
                  <thead class="table-light">
                    <tr>
                      <th>Product</th>
                      <th>SKU</th>
                      <th>Price</th>
                      <th>Quantity</th>
                      <th class="text-end">Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for line_item in order.line_items %}
                      <tr>
                        <td>
                          <div class="d-flex align-items-center">
                            {% if line_item.image %}
                              <img src="{{ line_item.image | image_url: width: 60, height: 60 }}" 
                                   alt="{{ line_item.title }}" 
                                   class="me-3 rounded border" width="60" height="60">
                            {% else %}
                              <div class="me-3 text-muted">No Image</div>
                            {% endif %}
                            <div>
                              <strong><a href="{{ line_item.url }}" class="text-dark">{{ line_item.title }}</a></strong>
                              {% if line_item.variant_title != 'Default Title' %}
                                <p class="mb-0 small text-muted">{{ line_item.variant_title }}</p>
                              {% endif %}
                              
                              {% if line_item.fulfillment %}
                                <div class="mt-2 p-2 border rounded bg-light">
                                  <small class="d-block">Fulfilled on: {{ line_item.fulfillment.created_at | time_tag: format: 'date' }}</small>
                                  {% if line_item.fulfillment.tracking_url %}
                                    <a href="{{ line_item.fulfillment.tracking_url }}" class="btn btn-sm btn-outline-primary mt-1">Track Order</a>
                                  {% endif %}
                                  <small class="d-block text-muted">{{ line_item.fulfillment.tracking_company }} {{ line_item.fulfillment.tracking_number }}</small>
                                </div>
                              {% endif %}
                            </div>
                          </div>
                        </td>
                        <td>{{ line_item.sku }}</td>
                        <td>{{ line_item.final_price | money }}</td>
                        <td>{{ line_item.quantity }}</td>
                        <td class="text-end">{{ line_item.final_line_price | money }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                  <tfoot class="table-light">
                    <tr>
                      <td colspan="4">Subtotal</td>
                      <td class="text-end">{{ order.line_items_subtotal_price | money }}</td>
                    </tr>
                    {% if order.shipping_methods.size > 0 %}
                      {% for shipping_method in order.shipping_methods %}
                        <tr>
                          <td colspan="4">Shipping ({{ shipping_method.title }})</td>
                          <td class="text-end">{{ shipping_method.price | money }}</td>
                        </tr>
                      {% endfor %}
                    {% endif %}
                    {% if order.tax_lines.size > 0 %}
                      {% for tax_line in order.tax_lines %}
                        <tr>
                          <td colspan="4">Tax - {{ tax_line.title }} ({{ tax_line.rate | times: 100 }}%)</td>
                          <td class="text-end">{{ tax_line.price | money }}</td>
                        </tr>
                      {% endfor %}
                    {% endif %}
                    <tr class="fw-bold">
                      <td colspan="4">Total</td>
                      <td class="text-end">{{ order.total_net_amount | money_with_currency }}</td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-body">
              <h5 class="fw-bold mb-3">Billing Details</h5>
              <ul class="list-unstyled small">
                <li><strong>Name:</strong> {{ order.billing_address.name }}</li>
                <li><strong>Email:</strong> {{ order.email }}</li>
                {% if order.billing_address.phone %}
                  <li><strong>Phone:</strong> {{ order.billing_address.phone }}</li>
                {% endif %}
                <li>
                  <strong>Address:</strong><br>
                  {{ order.billing_address.address1 }}, 
                  {% if order.billing_address.address2 %} {{ order.billing_address.address2 }}, {% endif %}
                  {{ order.billing_address.city }}, 
                  {{ order.billing_address.province_code }}, 
                  {{ order.billing_address.zip }}, 
                  {{ order.billing_address.country }}
                </li>
              </ul>
            </div>
          </div>

          {% if order.shipping_address %}
            <div class="card shadow-sm border-0">
              <div class="card-body">
                <h5 class="fw-bold mb-3">Shipping Details</h5>
                <ul class="list-unstyled small">
                  <li><strong>Name:</strong> {{ order.shipping_address.name }}</li>
                  {% if order.shipping_address.phone %}
                    <li><strong>Phone:</strong> {{ order.shipping_address.phone }}</li>
                  {% endif %}
                  <li>
                    <strong>Address:</strong><br>
                    {{ order.shipping_address.address1 }}, 
                    {% if order.shipping_address.address2 %} {{ order.shipping_address.address2 }}, {% endif %}
                    {{ order.shipping_address.city }}, 
                    {{ order.shipping_address.province_code }}, 
                    {{ order.shipping_address.zip }}, 
                    {{ order.shipping_address.country }}
                  </li>
                </ul>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
